<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generate a contact matrix from diary survey data — contact_matrix • socialmixr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate a contact matrix from diary survey data — contact_matrix"><meta name="description" content="Samples a contact survey"><meta property="og:description" content="Samples a contact survey"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">socialmixr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/socialmixr.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiforecasts/socialmixr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generate a contact matrix from diary survey data</h1>
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/socialmixr/blob/main/R/contact_matrix.r" class="external-link"><code>R/contact_matrix.r</code></a></small>
      <div class="d-none name"><code>contact_matrix.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Samples a contact survey</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">contact_matrix</span><span class="op">(</span></span>
<span>  <span class="va">survey</span>,</span>
<span>  countries <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">survey.pop</span>,</span>
<span>  <span class="va">age.limits</span>,</span>
<span>  <span class="va">filter</span>,</span>
<span>  counts <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  symmetric <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  split <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  sample.participants <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  estimated.participant.age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"sample"</span>, <span class="st">"missing"</span><span class="op">)</span>,</span>
<span>  estimated.contact.age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mean"</span>, <span class="st">"sample"</span>, <span class="st">"missing"</span><span class="op">)</span>,</span>
<span>  missing.participant.age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"remove"</span>, <span class="st">"keep"</span><span class="op">)</span>,</span>
<span>  missing.contact.age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"remove"</span>, <span class="st">"sample"</span>, <span class="st">"keep"</span>, <span class="st">"ignore"</span><span class="op">)</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  weigh.dayofweek <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  weigh.age <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  weight.threshold <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  symmetric.norm.threshold <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  sample.all.age.groups <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return.part.weights <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return.demography <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  per.capita <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-survey">survey<a class="anchor" aria-label="anchor" href="#arg-survey"></a></dt>
<dd><p>a <code><a href="survey.html">survey()</a></code> object</p></dd>


<dt id="arg-countries">countries<a class="anchor" aria-label="anchor" href="#arg-countries"></a></dt>
<dd><p>limit to one or more countries; if not given, will use all countries in the survey; these can be given as country names or 2-letter (ISO Alpha-2) country codes</p></dd>


<dt id="arg-survey-pop">survey.pop<a class="anchor" aria-label="anchor" href="#arg-survey-pop"></a></dt>
<dd><p>survey population – either a data frame with columns 'lower.age.limit' and 'population', or a character vector giving the name(s) of a country or countries from the list that can be obtained via <code>wpp_countries</code>; if not given, will use the country populations from the chosen countries, or all countries in the survey if <code>countries</code> is not given</p></dd>


<dt id="arg-age-limits">age.limits<a class="anchor" aria-label="anchor" href="#arg-age-limits"></a></dt>
<dd><p>lower limits of the age groups over which to construct the matrix</p></dd>


<dt id="arg-filter">filter<a class="anchor" aria-label="anchor" href="#arg-filter"></a></dt>
<dd><p>any filters to apply to the data, given as list of the form (column=filter_value) - only contacts that have 'filter_value' in 'column' will be considered. If multiple filters are given, they are all applied independently and in the sequence given.</p></dd>


<dt id="arg-counts">counts<a class="anchor" aria-label="anchor" href="#arg-counts"></a></dt>
<dd><p>whether to return counts (instead of means)</p></dd>


<dt id="arg-symmetric">symmetric<a class="anchor" aria-label="anchor" href="#arg-symmetric"></a></dt>
<dd><p>whether to make matrix symmetric, such that \(c_{ij}N_i = c_{ji}N_j\).</p></dd>


<dt id="arg-split">split<a class="anchor" aria-label="anchor" href="#arg-split"></a></dt>
<dd><p>whether to split the contact matrix into the mean number of contacts, in each age group (split further into the product of the mean number of contacts across the whole population (<code>mean.contacts</code>), a normalisation constant (<code>normalisation</code>) and age-specific variation in contacts (<code>contacts</code>)), multiplied with an assortativity matrix (<code>assortativity</code>) and a population multiplier (<code>demograpy</code>). For more detail on this, see the "Getting Started" vignette.</p></dd>


<dt id="arg-sample-participants">sample.participants<a class="anchor" aria-label="anchor" href="#arg-sample-participants"></a></dt>
<dd><p>whether to sample participants randomly (with replacement); done multiple times this can be used to assess uncertainty in the generated contact matrices. See the "Bootstrapping" section in the vignette for how to do this..</p></dd>


<dt id="arg-estimated-participant-age">estimated.participant.age<a class="anchor" aria-label="anchor" href="#arg-estimated-participant-age"></a></dt>
<dd><p>if set to "mean" (default), people whose ages are given as a range (in columns named "..._est_min" and "..._est_max") but not exactly (in a column named "..._exact") will have their age set to the mid-point of the range; if set to "sample", the age will be sampled from the range; if set to "missing", age ranges will be treated as missing</p></dd>


<dt id="arg-estimated-contact-age">estimated.contact.age<a class="anchor" aria-label="anchor" href="#arg-estimated-contact-age"></a></dt>
<dd><p>if set to "mean" (default), contacts whose ages are given as a range (in columns named "..._est_min" and "..._est_max") but not exactly (in a column named "..._exact") will have their age set to the mid-point of the range; if set to "sample", the age will be sampled from the range; if set to "missing", age ranges will be treated as missing</p></dd>


<dt id="arg-missing-participant-age">missing.participant.age<a class="anchor" aria-label="anchor" href="#arg-missing-participant-age"></a></dt>
<dd><p>if set to "remove" (default), participants without age information are removed; if set to "keep", participants with missing age are kept and treated as a separate age group</p></dd>


<dt id="arg-missing-contact-age">missing.contact.age<a class="anchor" aria-label="anchor" href="#arg-missing-contact-age"></a></dt>
<dd><p>if set to "remove" (default), participants that have contacts without age information are removed; if set to "sample", contacts without age information are sampled from all the contacts of participants of the same age group; if set to "keep", contacts with missing age are kept and treated as a separate age group; if set to "ignore", contact with missing age are ignored in the contact analysis</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>column names(s) of the participant data of the <code><a href="survey.html">survey()</a></code> object with user-specified weights (default = empty vector)</p></dd>


<dt id="arg-weigh-dayofweek">weigh.dayofweek<a class="anchor" aria-label="anchor" href="#arg-weigh-dayofweek"></a></dt>
<dd><p>whether to weigh social contacts data by the day of the week (weight (5/7 / N_week / N) for weekdays and (2/7 / N_weekend / N) for weekends)</p></dd>


<dt id="arg-weigh-age">weigh.age<a class="anchor" aria-label="anchor" href="#arg-weigh-age"></a></dt>
<dd><p>whether to weigh social contacts data by the age of the participants (vs. the populations' age distribution)</p></dd>


<dt id="arg-weight-threshold">weight.threshold<a class="anchor" aria-label="anchor" href="#arg-weight-threshold"></a></dt>
<dd><p>threshold value for the standardized weights before running an additional standardisation (default 'NA' = no cutoff)</p></dd>


<dt id="arg-symmetric-norm-threshold">symmetric.norm.threshold<a class="anchor" aria-label="anchor" href="#arg-symmetric-norm-threshold"></a></dt>
<dd><p>threshold value for the normalization weights when <code>symmetric = TRUE</code> before showing a warning that that large differences in the size of the sub-populations are likely to result in artefacts when making the matrix symmetric (default 2).</p></dd>


<dt id="arg-sample-all-age-groups">sample.all.age.groups<a class="anchor" aria-label="anchor" href="#arg-sample-all-age-groups"></a></dt>
<dd><p>what to do if sampling participants (with <code>sample.participants = TRUE</code>) fails to sample participants from one or more age groups; if FALSE (default), corresponding rows will be set to NA, if TRUE the sample will be discarded and a new one taken instead</p></dd>


<dt id="arg-return-part-weights">return.part.weights<a class="anchor" aria-label="anchor" href="#arg-return-part-weights"></a></dt>
<dd><p>boolean to return the participant weights</p></dd>


<dt id="arg-return-demography">return.demography<a class="anchor" aria-label="anchor" href="#arg-return-demography"></a></dt>
<dd><p>boolean to explicitly return demography data that corresponds to the survey data (default 'NA' = if demography data is requested by other function parameters)</p></dd>


<dt id="arg-per-capita">per.capita<a class="anchor" aria-label="anchor" href="#arg-per-capita"></a></dt>
<dd><p>whether to return a matrix with contact rates per capita (default is FALSE and not possible if 'counts=TRUE' or 'split=TRUE')</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>further arguments to pass to <code><a href="get_survey.html">get_survey()</a></code>, <code><a href="check.html">check()</a></code> and <code><a href="pop_age.html">pop_age()</a></code> (especially column names)</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a contact matrix, and the underlying demography of the surveyed population</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Sebastian Funk</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">polymod</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">contact_matrix</span><span class="op">(</span><span class="va">polymod</span>, countries <span class="op">=</span> <span class="st">"United Kingdom"</span>, age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Removing participants that have contacts without age information. To change this behaviour, set the 'missing.contact.age' option</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $matrix</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          contact.age.group</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age.group      [0,1)     [1,5)   [5,15)      15+</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    [0,1)  0.40000000 0.8000000 1.266667 5.933333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    [1,5)  0.11250000 1.9375000 1.462500 5.450000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    [5,15) 0.02450980 0.5049020 7.946078 6.215686</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    15+    0.03230337 0.3581461 1.290730 9.594101</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $participants</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    age.group participants proportion</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       &lt;char&gt;        &lt;int&gt;      &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:     [0,1)           15 0.01483680</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2:     [1,5)           80 0.07912957</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:    [5,15)          204 0.20178042</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4:       15+          712 0.70425321</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Funk, Lander Willem, Hugo Gruson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

