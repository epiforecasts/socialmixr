<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>The socialmixr package • socialmixr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="intro_files/libs/quarto-html/popper.min.js"></script><script src="intro_files/libs/quarto-html/tippy.umd.min.js"></script><link href="intro_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="intro_files/libs/quarto-html/light-border.css" rel="stylesheet">
<!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The socialmixr package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">socialmixr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/socialmixr.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/intro.html">The socialmixr package</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiforecasts/socialmixr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-quarto">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>The socialmixr package</h1>

      <p class="author">Sebastian Funk</p>
      <p class="date">2025-06-24</p>

      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/socialmixr/blob/main/vignettes/intro.qmd" class="external-link"><code>vignettes/intro.qmd</code></a></small>
      <div class="d-none name"><code></code></div>
    </div>






    <p><a href="https://github.com/epiforecasts/socialmixr" class="external-link">socialmixr</a> is an <code>R</code> package to derive social mixing matrices from survey data. These are particularly useful for age-structured <a href="https://en.wikipedia.org/wiki/Mathematical_modelling_of_infectious_disease" class="external-link">infectious disease models</a>. For background on age-specific mixing matrices and what data inform them, see, for example, the paper on POLYMOD by <span class="citation" data-cites="mossong_social_2008">[@mossong_social_2008]</span>.</p>
<section class="section level2"><h2 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h2>
<p>At the heart of the <code>socialmixr</code> package is the <code><a href="../reference/contact_matrix.html">contact_matrix()</a></code> function. This extracts a contact matrix from survey data. You can use the <code>R</code> help to find out about usage of the <code><a href="../reference/contact_matrix.html">contact_matrix()</a></code> function, including a list of examples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">contact_matrix</span></span></code></pre></div>
</div>
<p>The POLYMOD data are included with the package and can be loaded using</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">polymod</span><span class="op">)</span></span></code></pre></div>
</div>
<p>An example use would be</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/contact_matrix.html">contact_matrix</a></span><span class="op">(</span><span class="va">polymod</span>, countries <span class="op">=</span> <span class="st">"United Kingdom"</span>, age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Removing participants that have contacts without age information. To change this behaviour, set the 'missing.contact.age' option</span></span>
<span><span class="co">#&gt; $matrix</span></span>
<span><span class="co">#&gt;          contact.age.group</span></span>
<span><span class="co">#&gt; age.group      [0,1)     [1,5)   [5,15)      15+</span></span>
<span><span class="co">#&gt;    [0,1)  0.40000000 0.8000000 1.266667 5.933333</span></span>
<span><span class="co">#&gt;    [1,5)  0.11250000 1.9375000 1.462500 5.450000</span></span>
<span><span class="co">#&gt;    [5,15) 0.02450980 0.5049020 7.946078 6.215686</span></span>
<span><span class="co">#&gt;    15+    0.03230337 0.3581461 1.290730 9.594101</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $participants</span></span>
<span><span class="co">#&gt;    age.group participants proportion</span></span>
<span><span class="co">#&gt;       &lt;char&gt;        &lt;int&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     [0,1)           15 0.01483680</span></span>
<span><span class="co">#&gt; 2:     [1,5)           80 0.07912957</span></span>
<span><span class="co">#&gt; 3:    [5,15)          204 0.20178042</span></span>
<span><span class="co">#&gt; 4:       15+          712 0.70425321</span></span></code></pre></div>
</div>
<p>This generates a contact matrix from the UK part of the POLYMOD study, with age groups 0-1, 1-5, 5-15 and 15+ years. It contains the mean number of contacts that each member of an age group (row) has reported with members of the same or another age group (column).</p>
</section><section class="section level2"><h2 id="surveys">Surveys<a class="anchor" aria-label="anchor" href="#surveys"></a>
</h2>
<p>The key argument to the <code><a href="../reference/contact_matrix.html">contact_matrix()</a></code> function is the <code>survey</code> that it supposed to use. The <code>socialmixr</code> package includes the POLYMOD survey, which will be used if not survey is specified. It also provides access to all surveys in the <a href="https://zenodo.org/communities/social_contact_data" class="external-link">Social contact data</a> community on <a href="https://zenodo.org" class="external-link">Zenodo</a>. The available surveys can be listed (if an internet connection is available) with</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/list_surveys.html">list_surveys</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<p>A survey can be downloaded using the <code><a href="../reference/get_survey.html">get_survey()</a></code> command. This will get the relevant data of a survey given its Zenodo DOI (as returned by <code><a href="../reference/list_surveys.html">list_surveys()</a></code>). All other relevant commands in the <code>socialmixr</code> package accept a DOI, but if a survey is to be used repeatedly it is worth downloading it and storing it locally to avoid the need for a network connection and speed up processing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">peru_survey</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_survey.html">get_survey</a></span><span class="op">(</span><span class="st">"https://doi.org/10.5281/zenodo.1095664"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">peru_survey</span>, <span class="st">"peru.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>This way, the <code>peru</code> data set can be loaded in the future without the need for an internet connection using</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">peru_survey</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"peru.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
<p>Some surveys may contain data from multiple countries. To check this, use the <code>survey_countries</code> function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/survey_countries.html">survey_countries</a></span><span class="op">(</span><span class="va">polymod</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Italy"          "Germany"        "Luxembourg"     "Netherlands"   </span></span>
<span><span class="co">#&gt; [5] "Poland"         "United Kingdom" "Finland"        "Belgium"</span></span></code></pre></div>
</div>
<p>If one wishes to get a contact matrix for one or more specific countries, a <code>countries</code> argument can be passed to <code><a href="../reference/contact_matrix.html">contact_matrix()</a></code>. If this is not done, the different surveys contained in a dataset are combined as if they were one single sample (i.e., not applying any population-weighting by country or other correction).</p>
<p>By default, socialmixr uses the POLYMOD survey. A reference for any given survey can be obtained using <code><a href="../reference/get_citation.html">get_citation()</a></code>, e.g.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_citation.html">get_citation</a></span><span class="op">(</span><span class="va">polymod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Mossong J, Hens N, Jit M, Beutels P, Auranen K, Mikolajczyk R, Massari</span></span>
<span><span class="co">#&gt; M, Salmaso S, Tomba GS, Wallinga J, Heijne J, Sadkowska-Todys M,</span></span>
<span><span class="co">#&gt; Rosinska M, Edmunds WJ (2017). "POLYMOD social contact data."</span></span>
<span><span class="co">#&gt; doi:10.5281/zenodo.1157934 &lt;https://doi.org/10.5281/zenodo.1157934&gt;,</span></span>
<span><span class="co">#&gt; Version 1.1.</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="bootstrapping">Bootstrapping<a class="anchor" aria-label="anchor" href="#bootstrapping"></a>
</h2>
<p>To get an idea of uncertainty of the contact matrices, a bootstrap can be used using the <code>sample.participants</code> argument of <code><a href="../reference/contact_matrix.html">contact_matrix()</a></code>. If this argument is set to TRUE, participants are sampled (with replacement, to get the same number of participants of the original study) every time the <code><a href="../reference/contact_matrix.html">contact_matrix()</a></code> function is called, and thus a different matrix returned every time. From these matrices, derived quantities can be obtained, for example the mean:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span></span>
<span>  n <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  <span class="fu"><a href="../reference/contact_matrix.html">contact_matrix</a></span><span class="op">(</span></span>
<span>    <span class="va">polymod</span>,</span>
<span>    countries <span class="op">=</span> <span class="st">"United Kingdom"</span>, age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">15</span><span class="op">)</span>,</span>
<span>    sample.participants <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Removing participants that have contacts without age information. To change this behaviour, set the 'missing.contact.age' option</span></span>
<span><span class="co">#&gt; Removing participants that have contacts without age information. To change this behaviour, set the 'missing.contact.age' option</span></span>
<span><span class="co">#&gt; Removing participants that have contacts without age information. To change this behaviour, set the 'missing.contact.age' option</span></span>
<span><span class="co">#&gt; Removing participants that have contacts without age information. To change this behaviour, set the 'missing.contact.age' option</span></span>
<span><span class="co">#&gt; Removing participants that have contacts without age information. To change this behaviour, set the 'missing.contact.age' option</span></span>
<span><span class="va">mr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">m</span><span class="op">[</span><span class="st">"matrix"</span>, <span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">m</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mr</span></span>
<span><span class="co">#&gt;          contact.age.group</span></span>
<span><span class="co">#&gt; age.group      [0,1)     [1,5)   [5,15)      15+</span></span>
<span><span class="co">#&gt;    [0,1)  0.55574661 0.6273002 1.352700 6.048552</span></span>
<span><span class="co">#&gt;    [1,5)  0.09797307 1.7915057 1.527672 5.580072</span></span>
<span><span class="co">#&gt;    [5,15) 0.02126092 0.5169412 7.976242 6.439776</span></span>
<span><span class="co">#&gt;    15+    0.02645028 0.3693213 1.311169 9.573050</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="demography">Demography<a class="anchor" aria-label="anchor" href="#demography"></a>
</h2>
<p>Obtaining symmetric contact matrices, splitting out their components (see below) and age-specific participant weights require information about the underlying demographic composition of the survey population. This can be passed to <code><a href="../reference/contact_matrix.html">contact_matrix()</a></code> as the <code>survey.pop</code> argument, a <code>data.frame</code> with two columns, <code>lower.age.limit</code> (denoting the lower end of the age groups) and <code>population</code> (denoting the number of people in each age group). If no <code>survey.pop</code> is not given, <code><a href="../reference/contact_matrix.html">contact_matrix()</a></code> will try to obtain the age structure of the population (as per the <code>countries</code> argument) from the <a href="https://population.un.org/wpp/" class="external-link">World Population Prospects</a> of the United Nations, using estimates from the year that closest matches the year in which the contact survey was conducted.</p>
<p>If demographic information is used, this is returned by <code><a href="../reference/contact_matrix.html">contact_matrix()</a></code> as the <code>demography</code> field in the results list. It is possible to enforce or prevent the function to return demography data by using the <code>return.demography</code> option.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/contact_matrix.html">contact_matrix</a></span><span class="op">(</span><span class="va">polymod</span>,</span>
<span>  countries <span class="op">=</span> <span class="st">"United Kingdom"</span>, age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span><span class="op">)</span>,</span>
<span>  return.demography <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">demography</span></span>
<span><span class="co">#&gt;    age.group population proportion  year</span></span>
<span><span class="co">#&gt;       &lt;char&gt;      &lt;num&gt;      &lt;num&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:    [0,20)   14799290  0.2454816  2005</span></span>
<span><span class="co">#&gt; 2:       20+   45487461  0.7545184  2005</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="symmetric-contact-matrices">Symmetric contact matrices<a class="anchor" aria-label="anchor" href="#symmetric-contact-matrices"></a>
</h2>
<p>Conceivably, contact matrices should be symmetric: the total number of contacts made by members of one age group with those of another should be the same as vice versa. Mathematically, if <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">m_{ij}</annotation></semantics></math> is the mean number of contacts made by members of age group <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> with members of age group <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>, and the total number of people in age group <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> is <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mi>i</mi></msub><annotation encoding="application/x-tex">N_i</annotation></semantics></math>, then</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>N</mi><mi>i</mi></msub><mo>=</mo><msub><mi>m</mi><mrow><mi>j</mi><mi>i</mi></mrow></msub><msub><mi>N</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex">m_{ij} N_i = m_{ji}N_j</annotation></semantics></math></p>
<p>Because of variation in the sample from which the contact matrix is obtained, this relationship is usually not fulfilled exactly. In order to obtain a symmetric contact matrix that fulfills it, one can use</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><msub><mi>′</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mfrac><mn>1</mn><mrow><mn>2</mn><msub><mi>N</mi><mi>i</mi></msub></mrow></mfrac><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>N</mi><mi>i</mi></msub><mo>+</mo><msub><mi>m</mi><mrow><mi>j</mi><mi>i</mi></mrow></msub><msub><mi>N</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">m'_{ij} = \frac{1}{2N_i} (m_{ij} N_i + m_{ji} N_j)</annotation></semantics></math></p>
<p>To get this version of the contact matrix, use <code>symmetric = TRUE</code> when calling the <code><a href="../reference/contact_matrix.html">contact_matrix()</a></code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/contact_matrix.html">contact_matrix</a></span><span class="op">(</span><span class="va">polymod</span>, countries <span class="op">=</span> <span class="st">"United Kingdom"</span>, age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">15</span><span class="op">)</span>, symmetric <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Removing participants that have contacts without age information. To change this behaviour, set the 'missing.contact.age' option</span></span>
<span><span class="co">#&gt; Warning in pop_age(survey.pop, part.age.group.present, ...): Not all age groups represented in population data (5-year age band).</span></span>
<span><span class="co">#&gt;   Linearly estimating age group sizes from the 5-year bands.</span></span>
<span><span class="co">#&gt; Warning in contact_matrix(polymod, countries = "United Kingdom", age.limits =</span></span>
<span><span class="co">#&gt; c(0, : Large differences in the size of the sub-populations with the current</span></span>
<span><span class="co">#&gt; age breaks are likely to result in artefacts after making the matrix symmetric.</span></span>
<span><span class="co">#&gt; Please reconsider the age breaks to obtain more equally sized sub-populations.</span></span>
<span><span class="co">#&gt; Normalization factors: [0.3;2.9]</span></span>
<span><span class="co">#&gt; $matrix</span></span>
<span><span class="co">#&gt;          contact.age.group</span></span>
<span><span class="co">#&gt; age.group      [0,1)     [1,5)   [5,15)      15+</span></span>
<span><span class="co">#&gt;    [0,1)  0.40000000 0.6250000 0.764365 4.122919</span></span>
<span><span class="co">#&gt;    [1,5)  0.15625000 1.9375000 1.406063 5.929829</span></span>
<span><span class="co">#&gt;    [5,15) 0.07148821 0.5260153 7.946078 7.428739</span></span>
<span><span class="co">#&gt;    15+    0.05759306 0.3313352 1.109550 9.594101</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $demography</span></span>
<span><span class="co">#&gt;    age.group population proportion  year</span></span>
<span><span class="co">#&gt;       &lt;char&gt;      &lt;num&gt;      &lt;num&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:     [0,1)     690734 0.01145748  2005</span></span>
<span><span class="co">#&gt; 2:     [1,5)    2762936 0.04582990  2005</span></span>
<span><span class="co">#&gt; 3:    [5,15)    7385454 0.12250542  2005</span></span>
<span><span class="co">#&gt; 4:       15+   49447627 0.82020720  2005</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $participants</span></span>
<span><span class="co">#&gt;    age.group participants proportion</span></span>
<span><span class="co">#&gt;       &lt;char&gt;        &lt;int&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     [0,1)           15 0.01483680</span></span>
<span><span class="co">#&gt; 2:     [1,5)           80 0.07912957</span></span>
<span><span class="co">#&gt; 3:    [5,15)          204 0.20178042</span></span>
<span><span class="co">#&gt; 4:       15+          712 0.70425321</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="contact-rates-per-capita">Contact rates per capita<a class="anchor" aria-label="anchor" href="#contact-rates-per-capita"></a>
</h2>
<p>The contact matrix per capita <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>c</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">c_{ij}</annotation></semantics></math> contains the social contact rates of one individual of age <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> with one individual of age <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>, given the population details. For example, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>c</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">c_{ij}</annotation></semantics></math> is used in infectious disease modelling to calculate the force of infection, which is based on the likelihood that one susceptible individual of age <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> will be in contact with one infectious individual of age <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>. The contact rates per capita are calculated as follows:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mfrac displaystyle="false"><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>N</mi><mi>j</mi></msub></mfrac></mrow><annotation encoding="application/x-tex">c_{ij} =  \tfrac{m_{ij}}{N_{j}}</annotation></semantics></math></p>
<p>To get the per capita contact matrix, use <code>per.capita = TRUE</code> when calling the <code><a href="../reference/contact_matrix.html">contact_matrix()</a></code> function. Please note that if the option <code>symmetric = TRUE</code> is specified, the contact matrix <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">m_{ij}</annotation></semantics></math> can show asymmetry if the sub-population sizes are different, but the contact matrix per capita will be fully symmetric:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><msub><mi>′</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>N</mi><mi>i</mi></msub><mo>+</mo><msub><mi>m</mi><mrow><mi>j</mi><mi>i</mi></mrow></msub><msub><mi>N</mi><mi>j</mi></msub></mrow><mrow><mn>2</mn><msub><mi>N</mi><mi>i</mi></msub><msub><mi>N</mi><mi>j</mi></msub></mrow></mfrac><mo>=</mo><mi>c</mi><msub><mi>′</mi><mrow><mi>j</mi><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">c'_{ij} = \frac{m_{ij} N_i + m_{ji} N_j}{2N_iN_j} = c'_{ji}</annotation></semantics></math></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/contact_matrix.html">contact_matrix</a></span><span class="op">(</span>survey <span class="op">=</span> <span class="va">polymod</span>, countries <span class="op">=</span> <span class="st">"Germany"</span>, age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">60</span><span class="op">)</span>, symmetric <span class="op">=</span> <span class="cn">TRUE</span>, per.capita <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $matrix</span></span>
<span><span class="co">#&gt;          contact.age.group</span></span>
<span><span class="co">#&gt; age.group   [0,60)       60+</span></span>
<span><span class="co">#&gt;    [0,60) 7.743879 0.8967442</span></span>
<span><span class="co">#&gt;    60+    2.711694 2.1267606</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $matrix.per.capita</span></span>
<span><span class="co">#&gt;          contact.age.group</span></span>
<span><span class="co">#&gt; age.group       [0,60)          60+</span></span>
<span><span class="co">#&gt;    [0,60) 1.261735e-07 4.418248e-08</span></span>
<span><span class="co">#&gt;    60+    4.418248e-08 1.047852e-07</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $demography</span></span>
<span><span class="co">#&gt;    age.group population proportion  year</span></span>
<span><span class="co">#&gt;       &lt;char&gt;      &lt;num&gt;      &lt;num&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:    [0,60)   61374868  0.7514869  2005</span></span>
<span><span class="co">#&gt; 2:       60+   20296375  0.2485131  2005</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $participants</span></span>
<span><span class="co">#&gt;    age.group participants proportion</span></span>
<span><span class="co">#&gt;       &lt;char&gt;        &lt;int&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:    [0,60)         1062  0.8329412</span></span>
<span><span class="co">#&gt; 2:       60+          213  0.1670588</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="splitting-contact-matrices">Splitting contact matrices<a class="anchor" aria-label="anchor" href="#splitting-contact-matrices"></a>
</h2>
<p>The <code><a href="../reference/contact_matrix.html">contact_matrix()</a></code> contains a simple model for the elements of the contact matrix, by which it is split into a <em>global</em> component, as well as three components representing <em>contacts</em>, <em>assortativity</em> and <em>demography</em>. In other words, the elements <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">m_{ij}</annotation></semantics></math> of the contact matrix are modeled as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo>=</mo><mi>c</mi><mi>q</mi><msub><mi>d</mi><mi>i</mi></msub><msub><mi>a</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><msub><mi>n</mi><mi>j</mi></msub></mrow><annotation encoding="application/x-tex"> m_{ij} = c q d_i a_{ij} n_j </annotation></semantics></math></p>
<p>where <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math> is the mean number of contacts across the whole population, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>q</mi><msub><mi>d</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">c q d_i</annotation></semantics></math> is the number of contacts that a member of group <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> makes across age groups, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>j</mi></msub><annotation encoding="application/x-tex">n_j</annotation></semantics></math> is the proportion of the surveyed population in age group <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>j</mi><annotation encoding="application/x-tex">j</annotation></semantics></math>. The constant <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math> is set so that <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>q</mi></mrow><annotation encoding="application/x-tex">c q</annotation></semantics></math> is equal to the value of the largest eigenvalue of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">m_{ij}</annotation></semantics></math>; if used in an infectious disease model and assumed that every contact leads to infection, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>c</mi><mi>q</mi></mrow><annotation encoding="application/x-tex">c q</annotation></semantics></math> can be replaced by the basic reproduction number <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mn>0</mn></msub><annotation encoding="application/x-tex">R_0</annotation></semantics></math>.</p>
<p>To model the contact matrix in this way with the <code><a href="../reference/contact_matrix.html">contact_matrix()</a></code> function, set <code>split = TRUE</code>. The components of the matrix are returned as elements <code>mean.contacts</code> (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>c</mi><annotation encoding="application/x-tex">c</annotation></semantics></math>), <code>normalisation</code> (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>q</mi><annotation encoding="application/x-tex">q</annotation></semantics></math>), <code>contacts</code> (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>d</mi><mi>i</mi></msub><annotation encoding="application/x-tex">d_i</annotation></semantics></math>), <code>matrix</code> (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>a</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><annotation encoding="application/x-tex">a_{ij}</annotation></semantics></math>) and <code>demography</code> (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>j</mi></msub><annotation encoding="application/x-tex">n_j</annotation></semantics></math>) of the resulting list.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/contact_matrix.html">contact_matrix</a></span><span class="op">(</span><span class="va">polymod</span>, countries <span class="op">=</span> <span class="st">"United Kingdom"</span>, age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">15</span><span class="op">)</span>, split <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Removing participants that have contacts without age information. To change this behaviour, set the 'missing.contact.age' option</span></span>
<span><span class="co">#&gt; Warning in pop_age(survey.pop, part.age.group.present, ...): Not all age groups represented in population data (5-year age band).</span></span>
<span><span class="co">#&gt;   Linearly estimating age group sizes from the 5-year bands.</span></span>
<span><span class="co">#&gt; $mean.contacts</span></span>
<span><span class="co">#&gt; [1] 11.55481</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $normalisation</span></span>
<span><span class="co">#&gt; [1] 1.039163</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $contacts</span></span>
<span><span class="co">#&gt; [1] 0.6995727 0.7464190 1.2235173 0.9390331</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $matrix</span></span>
<span><span class="co">#&gt;          contact.age.group</span></span>
<span><span class="co">#&gt; age.group     [0,1)     [1,5)   [5,15)       15+</span></span>
<span><span class="co">#&gt;    [0,1)  4.1561551 2.0780776 1.230914 0.8611839</span></span>
<span><span class="co">#&gt;    [1,5)  1.0955555 4.7169752 1.332022 0.7413849</span></span>
<span><span class="co">#&gt;    [5,15) 0.1456110 0.7498969 4.415104 0.5158328</span></span>
<span><span class="co">#&gt;    15+    0.2500527 0.6930808 0.934443 1.0374170</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $demography</span></span>
<span><span class="co">#&gt;    age.group population proportion  year</span></span>
<span><span class="co">#&gt;       &lt;char&gt;      &lt;num&gt;      &lt;num&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:     [0,1)     690734 0.01145748  2005</span></span>
<span><span class="co">#&gt; 2:     [1,5)    2762936 0.04582990  2005</span></span>
<span><span class="co">#&gt; 3:    [5,15)    7385454 0.12250542  2005</span></span>
<span><span class="co">#&gt; 4:       15+   49447627 0.82020720  2005</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $participants</span></span>
<span><span class="co">#&gt;    age.group participants proportion</span></span>
<span><span class="co">#&gt;       &lt;char&gt;        &lt;int&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:     [0,1)           15 0.01483680</span></span>
<span><span class="co">#&gt; 2:     [1,5)           80 0.07912957</span></span>
<span><span class="co">#&gt; 3:    [5,15)          204 0.20178042</span></span>
<span><span class="co">#&gt; 4:       15+          712 0.70425321</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="filtering">Filtering<a class="anchor" aria-label="anchor" href="#filtering"></a>
</h2>
<p>The <code>filter</code> argument to <code><a href="../reference/contact_matrix.html">contact_matrix()</a></code> can be used to select particular participants or contacts. For example, in the <code>polymod</code> dataset, the indicators <code>cnt_home</code>, <code>cnt_work</code>, <code>cnt_school</code>, <code>cnt_transport</code>, <code>cnt_leisure</code> and <code>cnt_otherplace</code> take value 0 or 1 depending on where a contact occurred. Any filter can be applied to the data, if given as a list of the form (column=filter_value). As such, only contacts that have ‘filter_value’ in ‘column’ will be considered for the generated contact matrix:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># contact matrix for school-related contacts</span></span>
<span><span class="fu"><a href="../reference/contact_matrix.html">contact_matrix</a></span><span class="op">(</span><span class="va">polymod</span>, age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">60</span><span class="op">)</span>, filter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cnt_school <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">matrix</span></span>
<span><span class="co">#&gt;          contact.age.group</span></span>
<span><span class="co">#&gt; age.group     [0,20)    [20,60)        60+</span></span>
<span><span class="co">#&gt;   [0,20)  5.17103805 1.09641670 0.03583303</span></span>
<span><span class="co">#&gt;   [20,60) 0.45714286 0.47542857 0.01457143</span></span>
<span><span class="co">#&gt;   60+     0.08980827 0.07366297 0.03531786</span></span>
<span></span>
<span><span class="co"># contact matrix for work-related contacts involving physical contact</span></span>
<span><span class="fu"><a href="../reference/contact_matrix.html">contact_matrix</a></span><span class="op">(</span><span class="va">polymod</span>, age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">60</span><span class="op">)</span>, filter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cnt_work <span class="op">=</span> <span class="fl">1</span>, phys_contact <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">matrix</span></span>
<span><span class="co">#&gt;          contact.age.group</span></span>
<span><span class="co">#&gt; age.group     [0,20)    [20,60)         60+</span></span>
<span><span class="co">#&gt;   [0,20)  0.04285187 0.06353897 0.009235316</span></span>
<span><span class="co">#&gt;   [20,60) 0.16057143 1.27000000 0.146285714</span></span>
<span><span class="co">#&gt;   60+     0.04238143 0.29465187 0.062563068</span></span>
<span></span>
<span><span class="co"># contact matrix for daily contacts at home with males</span></span>
<span><span class="fu"><a href="../reference/contact_matrix.html">contact_matrix</a></span><span class="op">(</span><span class="va">polymod</span>, age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">60</span><span class="op">)</span>, filter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cnt_home <span class="op">=</span> <span class="fl">1</span>, cnt_gender <span class="op">=</span> <span class="st">"M"</span>, duration_multi <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">matrix</span></span>
<span><span class="co">#&gt;          contact.age.group</span></span>
<span><span class="co">#&gt; age.group     [0,20)   [20,60)        60+</span></span>
<span><span class="co">#&gt;   [0,20)  0.39268563 0.5858884 0.03103066</span></span>
<span><span class="co">#&gt;   [20,60) 0.25971429 0.3948571 0.04885714</span></span>
<span><span class="co">#&gt;   60+     0.05751766 0.1160444 0.23915237</span></span></code></pre></div>
</div>
</section><section class="section level2"><h2 id="participant-weights">Participant weights<a class="anchor" aria-label="anchor" href="#participant-weights"></a>
</h2>
<section class="level2"><h3 id="temporal-aspects-and-demography">Temporal aspects and demography<a class="anchor" aria-label="anchor" href="#temporal-aspects-and-demography"></a>
</h3>
<p>Participant weights are commonly used to align sample and population characteristics in terms of temporal aspects and the age distribution. For example, the day of the week has been reported as a driving factor for social contact behavior, hence to obtain a weekly average, the survey data should represent the weekly 2/5 distribution of weekend/week days. To align the survey data to this distribution, one can obtain participant weights in the form of: <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mtext mathvariant="normal">day.of.week</mtext></msub><mo>=</mo><mfrac displaystyle="false"><mrow><mn>5</mn><mi>/</mi><mn>7</mn></mrow><mrow><msub><mi>N</mi><mtext mathvariant="normal">weekday</mtext></msub><mi>/</mi><mi>N</mi></mrow></mfrac><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> OR </mtext><mspace width="0.333em"></mspace></mrow><mfrac displaystyle="false"><mrow><mn>2</mn><mi>/</mi><mn>7</mn></mrow><mrow><msub><mi>N</mi><mtext mathvariant="normal">weekend</mtext></msub><mi>/</mi><mi>N</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">w_{\textrm{day.of.week}} = \tfrac{5/7}{N_{\textrm{weekday}}/N} \text{  OR   } \tfrac{2/7}{N_{\textrm{weekend}}/N}</annotation></semantics></math> with sample size <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>, and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mrow><mi>w</mi><mi>e</mi><mi>e</mi><mi>k</mi><mi>d</mi><mi>a</mi><mi>y</mi></mrow></msub><annotation encoding="application/x-tex">N_{weekday}</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mrow><mi>w</mi><mi>e</mi><mi>e</mi><mi>k</mi><mi>e</mi><mi>n</mi><mi>d</mi></mrow></msub><annotation encoding="application/x-tex">N_{weekend}</annotation></semantics></math> the number of participants that were surveyed during weekdays and weekend days, respectively. It is possible to remove the constant values (e.g. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mo>=</mo><mn>5</mn><mi>/</mi><msub><mi>N</mi><mrow><mi>w</mi><mi>e</mi><mi>e</mi><mi>k</mi><mi>d</mi><mi>a</mi><mi>y</mi></mrow></msub></mrow><annotation encoding="application/x-tex">w = 5/N_{weekday}</annotation></semantics></math>), which results in the same standardized weights. However, we opt to use the relative proportions to calculate weights to enable truncation with a generic threshold (see below).</p>
<p>Another driver of social contact patterns is age. To improve the representativeness of survey data, age-specific weights can be calculated as: <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mrow><mi>a</mi><mi>g</mi><mi>e</mi></mrow></msub><mo>=</mo><mfrac displaystyle="false"><mrow><msub><mi>P</mi><mi>a</mi></msub><mspace width="0.222em"></mspace><mi>/</mi><mspace width="0.222em"></mspace><mi>P</mi></mrow><mrow><msub><mi>N</mi><mi>a</mi></msub><mspace width="0.222em"></mspace><mi>/</mi><mspace width="0.222em"></mspace><mi>N</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">w_{age} = \tfrac{P_{a}\ /\ P}{N_{a}\ /\ N}</annotation></semantics></math> with <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math> the population size, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>P</mi><mi>a</mi></msub><annotation encoding="application/x-tex">P_a</annotation></semantics></math> the population fraction of age <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math>, <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math> the survey sample size and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mi>a</mi></msub><annotation encoding="application/x-tex">N_a</annotation></semantics></math> the survey fraction of age <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math>. The combination of age-specific and temporal weights for participant <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> of age <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>a</mi><annotation encoding="application/x-tex">a</annotation></semantics></math> can be constructed as: <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>w</mi><mi>i</mi></msub><mo>=</mo><msub><mi>w</mi><mtext mathvariant="normal">age</mtext></msub><mo>*</mo><msub><mi>w</mi><mtext mathvariant="normal">day.of.week</mtext></msub></mrow><annotation encoding="application/x-tex">w_{i} = w_{\textrm{age}} * w_{\textrm{day.of.week}} </annotation></semantics></math> Finally, the weights can to be standardized as follows: <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>w</mi><mo accent="true">̃</mo></mover><mi>i</mi></msub><mo>=</mo><mfrac displaystyle="false"><msub><mi>w</mi><mi>i</mi></msub><mrow><munderover><mo>∑</mo><mrow></mrow><mrow></mrow></munderover><msub><mi>w</mi><mrow></mrow></msub></mrow></mfrac><mo>*</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">\tilde{w}_{i} =  \tfrac{w_{i}}{\sum_{}^{} w_{}} * N </annotation></semantics></math></p>
<p>If the social contact analysis is based on stratification by splitting the population into non-overlapping groups, it requires the weights to be standardized so that the weighted totals within mutually exclusive cells equal the known population totals <span class="citation" data-cites="kolenikov_post-stratification_2016">[@kolenikov_post-stratification_2016]</span>. The post-stratification cells need to be mutually exclusive and cover the whole population. The post-stratified (PS) weight for participant <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math> of is: <math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mover><mi>w</mi><mo accent="true">̃</mo></mover><mi>i</mi><mrow><mi>P</mi><mi>S</mi></mrow></msubsup><mo>=</mo><mfrac displaystyle="false"><msub><mi>w</mi><mi>i</mi></msub><mrow><munderover><mo>∑</mo><mtext mathvariant="normal">j</mtext><mtext mathvariant="normal">group g</mtext></munderover><msub><mi>w</mi><mi>j</mi></msub></mrow></mfrac><mo>*</mo><msub><mi>N</mi><mi>g</mi></msub></mrow><annotation encoding="application/x-tex">\tilde{w}^{PS}_{i} =  \tfrac{w_{i}}{\sum_{\text{j}}^{\text{group g}} w_{j}} * N_g</annotation></semantics></math></p>
<p>Temporal weights are activated in <code><a href="../reference/contact_matrix.html">contact_matrix()</a></code> by <code>weigh.dayofweek = TRUE</code> and age-specific weights by <code>weight.age = TRUE</code>. The post-stratification weights are calculated by default. It is possible to obtain the participant weights via the option <code>return.part.weights = TRUE</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/contact_matrix.html">contact_matrix</a></span><span class="op">(</span></span>
<span>  survey <span class="op">=</span> <span class="va">polymod</span>, age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">18</span>, <span class="fl">60</span><span class="op">)</span>, weigh.dayofweek <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  weigh.age <span class="op">=</span> <span class="cn">TRUE</span>, return.part.weights <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $matrix</span></span>
<span><span class="co">#&gt;          contact.age.group</span></span>
<span><span class="co">#&gt; age.group    [0,18)   [18,60)       60+</span></span>
<span><span class="co">#&gt;   [0,18)  8.5152158  5.839458 0.7193179</span></span>
<span><span class="co">#&gt;   [18,60) 2.0433998 10.318853 1.2413142</span></span>
<span><span class="co">#&gt;   60+     0.7761051  4.354554 2.4995467</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $demography</span></span>
<span><span class="co">#&gt;    age.group population proportion  year</span></span>
<span><span class="co">#&gt;       &lt;char&gt;      &lt;num&gt;      &lt;num&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:    [0,18)   52955807  0.1948624  2005</span></span>
<span><span class="co">#&gt; 2:   [18,60)  157719526  0.5803634  2005</span></span>
<span><span class="co">#&gt; 3:       60+   61084635  0.2247742  2005</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $participants</span></span>
<span><span class="co">#&gt;    age.group participants proportion</span></span>
<span><span class="co">#&gt;       &lt;char&gt;        &lt;int&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:    [0,18)         2462  0.3420395</span></span>
<span><span class="co">#&gt; 2:   [18,60)         3745  0.5202834</span></span>
<span><span class="co">#&gt; 3:       60+          991  0.1376771</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $participants.weights</span></span>
<span><span class="co">#&gt;      age.group participant.age is.weekday    weight participants   proportion</span></span>
<span><span class="co">#&gt;         &lt;fctr&gt;           &lt;int&gt;     &lt;lgcl&gt;     &lt;num&gt;        &lt;int&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1:    [0,18)               0      FALSE 1.4566422           27 0.0037510420</span></span>
<span><span class="co">#&gt;   2:    [0,18)               0       TRUE 1.3087772           66 0.0091692137</span></span>
<span><span class="co">#&gt;   3:    [0,18)               1      FALSE 1.1288977           32 0.0044456794</span></span>
<span><span class="co">#&gt;   4:    [0,18)               1       TRUE 1.0143024           88 0.0122256182</span></span>
<span><span class="co">#&gt;   5:    [0,18)               2      FALSE 0.9473268           39 0.0054181717</span></span>
<span><span class="co">#&gt;  ---                                                                         </span></span>
<span><span class="co">#&gt; 167:       60+              83       TRUE 5.6502663            4 0.0005557099</span></span>
<span><span class="co">#&gt; 168:       60+              84      FALSE 8.3848408            1 0.0001389275</span></span>
<span><span class="co">#&gt; 169:       60+              84       TRUE 7.5336884            2 0.0002778550</span></span>
<span><span class="co">#&gt; 170:       60+              85       TRUE 3.1671409            3 0.0004167824</span></span>
<span><span class="co">#&gt; 171:       60+              90       TRUE 4.7540746            1 0.0001389275</span></span></code></pre></div>
</div>
</section><section class="level2"><h3 id="user-defined-participant-weights">User-defined participant weights<a class="anchor" aria-label="anchor" href="#user-defined-participant-weights"></a>
</h3>
<p>The <code><a href="../reference/contact_matrix.html">contact_matrix()</a></code> allows to specify and use your own participant weights. Therefore, provide the names of the columns of the participant data you want to use to weight the reported contacts via the <code>weights</code> argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># e.g. use household size as (dummy) weight to provide more importance to participant data from large households</span></span>
<span><span class="fu"><a href="../reference/contact_matrix.html">contact_matrix</a></span><span class="op">(</span>survey <span class="op">=</span> <span class="va">polymod</span>, age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">18</span>, <span class="fl">60</span><span class="op">)</span>, weights <span class="op">=</span> <span class="st">"hh_size"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $matrix</span></span>
<span><span class="co">#&gt;          contact.age.group</span></span>
<span><span class="co">#&gt; age.group    [0,18)   [18,60)       60+</span></span>
<span><span class="co">#&gt;   [0,18)  8.9599558  5.907367 0.7338418</span></span>
<span><span class="co">#&gt;   [18,60) 2.4650353 10.960550 1.2399199</span></span>
<span><span class="co">#&gt;   60+     0.9909593  5.659468 2.7081868</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $participants</span></span>
<span><span class="co">#&gt;    age.group participants proportion</span></span>
<span><span class="co">#&gt;       &lt;char&gt;        &lt;int&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:    [0,18)         2462  0.3420395</span></span>
<span><span class="co">#&gt; 2:   [18,60)         3745  0.5202834</span></span>
<span><span class="co">#&gt; 3:       60+          991  0.1376771</span></span></code></pre></div>
</div>
</section><section class="level2"><h3 id="weight-threshold">Weight threshold<a class="anchor" aria-label="anchor" href="#weight-threshold"></a>
</h3>
<p>If the survey population differs extensively from the demography, some participants can end up with relatively high weights and as such, an excessive contribution to the population average. This warrants the limitation of single participant influences by a truncation of the weights. To enable this in <code><a href="../reference/contact_matrix.html">contact_matrix()</a></code>, you need to provide a numeric <code>weight.threshold</code>. This truncation is applied on the standardized weights, followed by another standardization to make sure that the sum of the weights still equals the sample size. The latter can lead to final weights of which some little exceed the given threshold value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/contact_matrix.html">contact_matrix</a></span><span class="op">(</span></span>
<span>  survey <span class="op">=</span> <span class="va">polymod</span>, age.limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">18</span>, <span class="fl">60</span><span class="op">)</span>, weigh.dayofweek <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  weigh.age <span class="op">=</span> <span class="cn">TRUE</span>, return.part.weights <span class="op">=</span> <span class="cn">TRUE</span>, weight.threshold <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $matrix</span></span>
<span><span class="co">#&gt;          contact.age.group</span></span>
<span><span class="co">#&gt; age.group    [0,18)   [18,60)       60+</span></span>
<span><span class="co">#&gt;   [0,18)  8.5152158  5.839458 0.7193179</span></span>
<span><span class="co">#&gt;   [18,60) 2.0433998 10.318853 1.2413142</span></span>
<span><span class="co">#&gt;   60+     0.7720958  4.410151 2.5401091</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $demography</span></span>
<span><span class="co">#&gt;    age.group population proportion  year</span></span>
<span><span class="co">#&gt;       &lt;char&gt;      &lt;num&gt;      &lt;num&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1:    [0,18)   52955807  0.1948624  2005</span></span>
<span><span class="co">#&gt; 2:   [18,60)  157719526  0.5803634  2005</span></span>
<span><span class="co">#&gt; 3:       60+   61084635  0.2247742  2005</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $participants</span></span>
<span><span class="co">#&gt;    age.group participants proportion</span></span>
<span><span class="co">#&gt;       &lt;char&gt;        &lt;int&gt;      &lt;num&gt;</span></span>
<span><span class="co">#&gt; 1:    [0,18)         2462  0.3420395</span></span>
<span><span class="co">#&gt; 2:   [18,60)         3745  0.5202834</span></span>
<span><span class="co">#&gt; 3:       60+          991  0.1376771</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $participants.weights</span></span>
<span><span class="co">#&gt;      age.group participant.age is.weekday    weight participants   proportion</span></span>
<span><span class="co">#&gt;         &lt;fctr&gt;           &lt;int&gt;     &lt;lgcl&gt;     &lt;num&gt;        &lt;int&gt;        &lt;num&gt;</span></span>
<span><span class="co">#&gt;   1:    [0,18)               0      FALSE 1.4566422           27 0.0037510420</span></span>
<span><span class="co">#&gt;   2:    [0,18)               0       TRUE 1.3087772           66 0.0091692137</span></span>
<span><span class="co">#&gt;   3:    [0,18)               1      FALSE 1.1288977           32 0.0044456794</span></span>
<span><span class="co">#&gt;   4:    [0,18)               1       TRUE 1.0143024           88 0.0122256182</span></span>
<span><span class="co">#&gt;   5:    [0,18)               2      FALSE 0.9473268           39 0.0054181717</span></span>
<span><span class="co">#&gt;  ---                                                                         </span></span>
<span><span class="co">#&gt; 167:       60+              83       TRUE 3.1063091            4 0.0005557099</span></span>
<span><span class="co">#&gt; 168:       60+              84      FALSE 3.1063091            1 0.0001389275</span></span>
<span><span class="co">#&gt; 169:       60+              84       TRUE 3.1063091            2 0.0002778550</span></span>
<span><span class="co">#&gt; 170:       60+              85       TRUE 3.1063091            3 0.0004167824</span></span>
<span><span class="co">#&gt; 171:       60+              90       TRUE 3.1063091            1 0.0001389275</span></span></code></pre></div>
</div>
</section><section class="level2"><h3 id="numerical-example">Numerical example<a class="anchor" aria-label="anchor" href="#numerical-example"></a>
</h3>
<p>With these numeric examples, we show the importance of post-stratification weights in contrast to using the crude weights directly within age-groups. We will apply the weights by age and day of week separately in these examples, though the combination is straightforward via multiplication.</p>
<section class="level3"><h4 id="get-survey-data">Get survey data<a class="anchor" aria-label="anchor" href="#get-survey-data"></a>
</h4>
<p>We start from a survey including 6 participants of 1, 2 and 3 years of age. The ages are not equally represented in the sample, though we assume they are equally present in the reference population. We will calculate the weighted average number of contacts by age and by age group, using {1,2} and {3} years of age. The following table shows the reported number of contacts per participant <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>, represented by <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>m</mi><mi>i</mi></msub><annotation encoding="application/x-tex">m_i</annotation></semantics></math>:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top">
<thead><tr class="header">
<th style="text-align: right;">age</th>
<th style="text-align: left;">day.of.week</th>
<th style="text-align: left;">age.group</th>
<th style="text-align: right;">m_i</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">week</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">week</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">week</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">15</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The summary statistics for the sample (N) and reference population (P) are as follows</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">6</span></span>
<span><span class="va">N_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">N_age.group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">N_day.of.week</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">P</span> <span class="op">&lt;-</span> <span class="fl">3000</span></span>
<span><span class="va">P_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">1000</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span><span class="va">P_age.group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2000</span>, <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">P_day.of.week</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span> <span class="op">/</span> <span class="fl">7</span>, <span class="fl">2</span> <span class="op">/</span> <span class="fl">7</span><span class="op">)</span> <span class="op">*</span> <span class="fl">3000</span></span></code></pre></div>
</div>
<p>This survey data results in an unweighted average number of contacts:</p>
<div class="cell">
<pre><code><span><span class="co">#&gt; [1] "unweighted average number of contacts: 7.83"</span></span></code></pre>
</div>
<p>and age-specific unweighted averages on the number of contacts:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top">
<thead><tr class="header">
<th style="text-align: right;">age</th>
<th style="text-align: left;">age.group</th>
<th style="text-align: right;">m_i</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">2.5</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">9.0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">15.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section class="level3"><h4 id="weight-by-day-of-week">Weight by day of week<a class="anchor" aria-label="anchor" href="#weight-by-day-of-week"></a>
</h4>
<p>The following table contains the participants weights based on the survey day with and without the population and sample size constants (<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>w</mi><annotation encoding="application/x-tex">w</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mi>′</mi></mrow><annotation encoding="application/x-tex">w'</annotation></semantics></math>, respectively). Note that the standardized weights <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>w</mi><mo accent="true">̃</mo></mover><annotation encoding="application/x-tex">\tilde{w}</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mrow><mi>w</mi><mi>′</mi></mrow><mo accent="true">̃</mo></mover><annotation encoding="application/x-tex">\tilde{w'}</annotation></semantics></math> are the same:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top">
<thead><tr class="header">
<th style="text-align: right;">age</th>
<th style="text-align: left;">day.of.week</th>
<th style="text-align: left;">age.group</th>
<th style="text-align: right;">m_i</th>
<th style="text-align: right;">w</th>
<th style="text-align: right;">w_tilde</th>
<th style="text-align: right;">w_dot</th>
<th style="text-align: right;">w_dot_tilde</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">285.71</td>
<td style="text-align: right;">0.57</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">285.71</td>
<td style="text-align: right;">0.57</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">285.71</td>
<td style="text-align: right;">0.57</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">week</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">714.29</td>
<td style="text-align: right;">1.43</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">week</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">714.29</td>
<td style="text-align: right;">1.43</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">week</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">714.29</td>
<td style="text-align: right;">1.43</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Note the different scale of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>w</mi><annotation encoding="application/x-tex">w</annotation></semantics></math> and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mi>′</mi></mrow><annotation encoding="application/x-tex">w'</annotation></semantics></math>, and the more straightforward interpretation of the numerical value of <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>w</mi><annotation encoding="application/x-tex">w</annotation></semantics></math> in terms of relative differences to apply truncation. Using the standardized weights, we are able to calculate the weighted number of contacts:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top">
<thead><tr class="header">
<th style="text-align: right;">age</th>
<th style="text-align: left;">day.of.week</th>
<th style="text-align: left;">age.group</th>
<th style="text-align: right;">m_i</th>
<th style="text-align: right;">w</th>
<th style="text-align: right;">w_tilde</th>
<th style="text-align: right;">m_i * w_tilde</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">1.71</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">1.14</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">5.13</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">week</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">14.30</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">week</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">11.44</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">week</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">21.45</td>
</tr>
</tbody>
</table>
</div>
<pre><code><span><span class="co">#&gt; [1] "weighted average number of contacts: 9.2"</span></span></code></pre>
</div>
<p>If the population-based weights are directly used in age-specific groups, the contact behavior of the 3 year-old participant, which participated during week day, is inflated due to the under-representation of week days in the survey sample. In addition, the number of contacts for 1 year-old participants is decreased because of the over-representation of weekend days in the survey. Using the population-weights within the two aggregated age groups, we obtain a more intuitive weighting for age group A, but it is still skewed for individuals in age group B. As such, this weighted average for age group B has no meaning in terms of social contact behavior:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table kable_wrapper"><tbody><tr>
<td>
<table class="table caption-top">
<thead><tr class="header">
<th style="text-align: right;">age</th>
<th style="text-align: right;">m_i * w_tilde</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.425</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">10.290</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">21.450</td>
</tr>
</tbody>
</table>
</td>
<td>
<table class="table caption-top">
<thead><tr class="header">
<th style="text-align: left;">age.group</th>
<th style="text-align: right;">m_i * w_tilde</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: right;">6.744</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: right;">21.450</td>
</tr>
</tbody>
</table>
</td>
</tr></tbody></table>
</div>
</div>
<p>If we subdivide the population, we need to use post-stratification weights (“w_PS”) in which the weighted totals within mutually exclusive cells equal the sample size. For the age groups, this goes as follows:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top">
<thead><tr class="header">
<th style="text-align: right;">age</th>
<th style="text-align: left;">day.of.week</th>
<th style="text-align: left;">age.group</th>
<th style="text-align: right;">m_i</th>
<th style="text-align: right;">w</th>
<th style="text-align: right;">w_tilde</th>
<th style="text-align: right;">w_PS</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">0.62</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">0.62</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">0.57</td>
<td style="text-align: right;">0.62</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">week</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">1.56</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">week</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">1.56</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">week</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">1.43</td>
<td style="text-align: right;">1.00</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The weighted means equal:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top">
<thead><tr class="header">
<th style="text-align: left;">age.group</th>
<th style="text-align: right;">m_i * w_PS</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: right;">7.352</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: right;">15.000</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section class="level3"><h4 id="weight-by-age">Weight by age<a class="anchor" aria-label="anchor" href="#weight-by-age"></a>
</h4>
<p>We repeated the example by calculating age-specific participant weights on the population and age-group level:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top">
<thead><tr class="header">
<th style="text-align: right;">age</th>
<th style="text-align: left;">day.of.week</th>
<th style="text-align: left;">age.group</th>
<th style="text-align: right;">m_i</th>
<th style="text-align: right;">w</th>
<th style="text-align: right;">w_tilde</th>
<th style="text-align: right;">w_PS</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.25</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.25</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: right;">0.83</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">week</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: right;">0.83</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">week</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: right;">0.83</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">week</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">1.00</td>
</tr>
</tbody>
</table>
</div>
<pre><code><span><span class="co">#&gt; [1] "weighted average number of contacts: 8.85"</span></span></code></pre>
</div>
<p>If the age-specific weights are directly used within the age groups, the contact behavior for age group B is inflated to unrealistic levels and the number of contacts for age group A is artificially low:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table kable_wrapper"><tbody><tr>
<td>
<table class="table caption-top">
<thead><tr class="header">
<th style="text-align: right;">age</th>
<th style="text-align: right;">m_i * w_tilde</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.50</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">6.03</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">30.00</td>
</tr>
</tbody>
</table>
</td>
<td>
<table class="table caption-top">
<thead><tr class="header">
<th style="text-align: left;">age.group</th>
<th style="text-align: right;">m_i * w_tilde</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: right;">4.618</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: right;">30.000</td>
</tr>
</tbody>
</table>
</td>
</tr></tbody></table>
</div>
</div>
<p>Using the post-stratification weights, we end up with:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top">
<thead><tr class="header">
<th style="text-align: left;">age.group</th>
<th style="text-align: right;">m_i * w_PS</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: right;">5.732</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: right;">15.000</td>
</tr>
</tbody>
</table>
</div>
</div>
</section><section class="level3"><h4 id="apply-threshold">Apply threshold<a class="anchor" aria-label="anchor" href="#apply-threshold"></a>
</h4>
<p>We start with survey data of 14 participants of 1, 2 and 3 years of age, sampled from a population in which all ages are equally present. Given the high representation of participants aged 1 year, the age-specific proportions are skewed in comparison with the reference population. If we calculate the age-specific weights and (un)weighted average number of contacts, we end up with:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table caption-top">
<thead><tr class="header">
<th style="text-align: right;">age</th>
<th style="text-align: left;">day.of.week</th>
<th style="text-align: left;">age.group</th>
<th style="text-align: right;">m_i</th>
<th style="text-align: right;">w</th>
<th style="text-align: right;">w_tilde</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.47</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.47</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.47</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.47</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.47</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.47</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.47</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.47</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.47</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.47</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">weekend</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">1.56</td>
<td style="text-align: right;">1.56</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: left;">week</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">1.56</td>
<td style="text-align: right;">1.56</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">week</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1.56</td>
<td style="text-align: right;">1.56</td>
</tr>
<tr class="even">
<td style="text-align: right;">3</td>
<td style="text-align: left;">week</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">4.67</td>
<td style="text-align: right;">4.67</td>
</tr>
</tbody>
</table>
</div>
<pre><code><span><span class="co">#&gt; [1] "unweighted average number of contacts: 5.86"</span></span>
<span><span class="co">#&gt; [1] "weighted average number of contacts: 13.86"</span></span></code></pre>
</div>
<p>The single participant of 3 years of age has a very large influence on the weighted population average. As such, we propose to truncate the relative age-specific weights <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>w</mi><annotation encoding="application/x-tex">w</annotation></semantics></math> at 3. As such, the weighted population average equals:</p>
<div class="cell">
<pre><code><span><span class="co">#&gt; [1] "weighted average number of contacts after truncation: 10.28"</span></span></code></pre>
</div>
</section></section></section><section class="section level2"><h2 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a>
</h2>
<section class="level2"><h3 id="using-ggplot2">Using ggplot2<a class="anchor" aria-label="anchor" href="#using-ggplot2"></a>
</h3>
<p>The contact matrices can be plotted by using the <code>geom_tile()</code> function of the <code>ggplot2</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">reshape2</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html" class="external-link">melt</a></span><span class="op">(</span><span class="va">mr</span>, varnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age.group"</span>, <span class="st">"age.group.contact"</span><span class="op">)</span>, value.name <span class="op">=</span> <span class="st">"contacts"</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">age.group</span>, y <span class="op">=</span> <span class="va">age.group.contact</span>, fill <span class="op">=</span> <span class="va">contacts</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_tile</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="intro_files/figure-html/unnamed-chunk-35-1.png" width="384"></p>
</figure>
</div>
</div>
</div>
</section><section class="level2"><h3 id="using-r-base">Using R base<a class="anchor" aria-label="anchor" href="#using-r-base"></a>
</h3>
<p>The contact matrices can also be plotted with the <code><a href="../reference/matrix_plot.html">matrix_plot()</a></code> function as a grid of colored rectangles with the numeric values in the cells. Heat colors are used by default, though this can be changed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/matrix_plot.html">matrix_plot</a></span><span class="op">(</span><span class="va">mr</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="intro_files/figure-html/unnamed-chunk-36-1.png" width="384"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/matrix_plot.html">matrix_plot</a></span><span class="op">(</span><span class="va">mr</span>, color.palette <span class="op">=</span> <span class="va">gray.colors</span><span class="op">)</span></span></code></pre></div>
<div class="cell-output-display">
<div>
<figure><p><img src="intro_files/figure-html/unnamed-chunk-36-2.png" width="384"></p>
</figure>
</div>
</div>
</div>
</section></section><section class="section level2"><h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
</section><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config);
    }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script></main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Sebastian Funk, Lander Willem, Hugo Gruson.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
